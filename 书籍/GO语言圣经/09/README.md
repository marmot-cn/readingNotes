# README

## 9.1 竞争条件

```
balance = balance + amount
```

是两步操作

1. 读取 balance + amount 的和
2. 写入 balance

2步期间可能会发生数据丢失，在余额被读到(balance + amount)之后，在余额被更新之前 (balance = ...)。这样会导致余额丢失。

无论任何时候，只要有两个goroutine 并发访问同一变量，且至少其中的一个是写操作的时候就会发生数据竞争。

数据竞争会在两个以上的goroutine并 发访问相同的变量且至少其中一个为写操作时发生。

### 避免数据竞争

1. 不要去写变量。
2. 避免从多个goroutine访问变量，不要使用共享数据来通信；使用通信来 共享数据。
3. 允许很多goroutine去访问变量，但是在同一个时刻最多只有一 个goroutine在访问。这种方式被称为“互斥”。

## 9.2. sync.Mutex互斥锁

一个只能为1和0的信号量叫做二元信号量。

## 9.3. sync.RWMutex读写锁

`sync.RWMutex`，允许多个只读操作并行执行，但写操作会完全互斥。叫作“多读单写”锁。

## 9.4. 内存同步

