# 进程与线程

## 说明

计算机的**CPU物理核数**是同时**可以并行运行的线程数量**，**CPU只能看到线程、线程是CPU调度分配的最小单位**。由于超线程技术，实际上可以并行的线程数量通常是物理核数的两倍，这也是操作系统看到的核数，所指的核也是超线程技术之后的核数。

进程是操作系统资源分配的最小单位，线程是执行调度（即CPU调度）的最小单位（CPU看到的都是线程而不是进程），一个进程可以有一个或多个线程，线程之间共享进程的资源。

如果计算机有多个CPU核，且计算机中的总的线程数量小于核数，那线程就可以并行运行在不同的核中，如果是单核多线程，那多线程之间就不是并行，而是并发。如果是多核多线程，且线程数量大于核数，其中有些线程就会不断切换，并发执行，但实际上最大的并行数量还是当前这个进程中的核的数量，所以盲目增加线程数不仅不会让你的程序更快，反而会给你的程序增加额外的开销。

**并发**，CPU调度器会不断的在单核上切换不同的线程执行。

**计算密集型**，加入用一个进程来完成这个任务，可以使用[核心数]个线程，就可以占满CPU资源，进而可以充分利用CPU，如果再多，就会造成额外的开销。

**IO密集型**，设计到网络、磁盘IO的任务都是IO密集型任务，线程由于被IO阻塞，如果仍然用[核心数]个线程，CPU是跑不满的。

### 并发与并行

并发是指一个处理器同时处理多个任务，并行是指多个处理器或者是多核处理器同时处理多个不同的任务。

并发是逻辑上的同时发生，并行是物理上的同时发生。

### 并行计算

**多进程**，因为每个进程资源是独立的（地址空间和数据空间），就要在操作系统层面进行通信，如管道，队列，信号灯；

**多线程**，多线程会共享进程中的地址空间和数据空间，一个线程的数据可以直接提供给其他线程使用，当会造成变量的混乱，所以要通过线程锁来限制线程的执行。

### 总结 

单CPU单核中线程只能并发，单CPU多核中线程可以并行。

单CPU中进程只能是并发，多CPU计算机中进程可以并行。