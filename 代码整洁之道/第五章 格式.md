# 第五章 格式

---

代码应该:

* 整洁
* 一致性(格式)

团队应该采用一套规则.

### 格式的目的

代码关乎沟通,沟通是专业开发者的头等大事.

今天编写的功能,既有可能在下一版本中被修改, 但代码的可读性却会对以后可能发生的修改行为产生深远影响.

### 垂直格式

源代码文件应该有多大:

* 大多数为 200 行
* 嘴仗 500 行

#### 向报纸学习

自上而下:

* 头条, 告诉故事的主题
* 故事的大纲, 粗线条概述, 但隐藏了故事细节
* 细节渐次增加

源文件==最顶部==应该给出==高层次==概念和算法. 细节应该==往下==渐次展开.

#### 概念间垂直方向上的区隔

代码 从上往下读, 从左往右读.

每行展现一个表达式或一个字句.

这些思路要用==空白行==区隔开来.

==每个空白行都是一条线索, 标识出新的独立概念==.

#### 垂直方向上的靠近

靠近的代码行则暗示了它们之间的紧密关系.

#### 垂直距离

对于那些关系密切, 放置于同一源文件中的概念, 它们之间的区隔应该成为对相互易懂度有多重要的衡量标准. 避免迫使读者在源文件和类中跳来跳去.

==关系近的放置在一起==.

**变量声明**

变量声明应间可能靠近其使用位置. 

**实体变量**

实体变量应该在类的顶部声明.

**相关函数**

若某个函数调用了另外一个, 就应该把它们放到一起, 而且==调用者应该尽可能放在被调用者上面==. 这样, 程序就有个自然的顺序.

==读者能够确信函数声明总会在其调用后很快出现==.

**概念相关**

概念相关的代码应该放到一起. 相关性越强, 彼此之间的距离就该越近.

#### 垂直顺序

自上向下展示函数调用依赖顺序: 被调用函数应该放在执行调用的函数下面.

* 最重要的概念先出来(包括最少细节的方式表述它们).
* 底层细节最后出来(自前面几个函数获知要旨, 而不至于沉溺到细节中).

### 横向格式

无需拖动滚动条到右边的原则.

上限是`120`个字符.

#### 水平方向上的区隔与靠近

**赋值操作**

```php
$name = 'jerry';
```

赋值操作符周围加上空格字符. 赋值语句有两个确定而重要的要素:

* 左边
* 右边

**函数参数**

```php
function test($p1, $p2) {
...
}
```

强调逗号, 表示参数是互相分离的.

**算术**

```php

$b*$b - 4*$a*$c;

```

用空格区分算术优先级.

#### 水平对齐

```php
class A {
	private 	Socket			socket;
	private 	InputStream		inputstream;
	private 	OutputStream	outputstream;

}
```

```php
class A {
	private Socket	socket;
	private InputStream	 inputstream;
	private OutputStream outputstream;

}
```

示例1是对齐的, 对齐像是在强调不重要的东西. 

作者更偏向于示例2的代码.

#### 缩进

代码要注意缩进, 读者从代码行左边查看自己在什么范围中工作.

```php
public class FitNesseServer implements SocketServer { private FitNessContext context;....
```

```php
public class FitNesseServer implements SocketServer {
	private FitNessContext context;
	...
}
```

下面的示例是具有缩进的代码, 代码要用==缩进表示范围==.

#### 空范围

确保空范围体的缩进, 用括号包围起来.

```php
while($a != -1);

while($a != -1) {}
```

### 团队规则

好的软件系统是由一系列读起来不错的代码文件组成的.

在一个源文件中看到的格式风格在其他文件中也是同样的用法. 绝对不要用各种不同风格来编写源代码, 这样会==增加复杂度==.

### 鲍勃大叔的格式规则

